"use strict";$(document).ready(function(){$(document).on("click",".btn-delete-request",function(e){e.preventDefault();var t=$(this),a=t.data("request-id");bootbox.confirm({title:Laravel.strings.delete_request_confirm_modal.title,message:Laravel.strings.delete_request_confirm_modal.message,buttons:{cancel:{label:'<i class="fa fa-times"></i> '+Laravel.strings.delete_request_confirm_modal.btn.cancel},confirm:{label:'<i class="fa fa-check"></i> '+Laravel.strings.delete_request_confirm_modal.btn.confirm,className:"btn-danger"}},callback:function(e){if(!0===e){var t=renderUrl(a,Laravel.apis.requests.delete);$.ajax({url:t,method:"DELETE",success:function(e){var t=e.message;generateNotification(t,"success",!0,2500),$(".modal").modal("hide")},error:function(e){}})}}})}),$(document).on("click",".btn-show-user-requests",function(e){e.preventDefault();var t=$(this).data("user-id"),a=renderUrl(t,Laravel.apis.users.getRequests);$.ajax({url:a,method:"GET",success:function(e){var t=e,a=Constants.MODALS_CONTAINER_ID,s=Constants.MODAL_TEMPLATE_ID,r=Constants.USER_REQUESTS_MODAL_ID,n={modal:{id:r,class:"auto-destroy",title:Laravel.strings.user_requests_modal.modal.title+" "+t.name,body:'<table id="user-requests-data-table" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>',footer:""}};_.renderTemplate(s,n,a,!0);var i=[];$.each(t.requests,function(e,t){var a="<dl>";$.each(t.properties,function(e,t){a+="<dt>"+t.title+"</dt>";var s=t.value;if("ALL"===s)s=Laravel.strings.user_requests.types.ALL;else if("NUMBER"===t.value_type&&(s=parseInt(s).toLocaleString("en"),t.extra_settings.currency)){var r=t.extra_settings.currency,n=getCurrencySymbolHtmlCode(r);n&&(s=n+" "+s)}a+="<dd>"+s+"</dd>"}),a+="</dl>",i.push([t.id,t.category.name,a])}),$("#user-requests-data-table").DataTable({data:i,bFilter:!1,bLengthChange:!1,pageLength:15,columns:[{title:"id"},{title:Laravel.strings.user_requests_modal.table_columns_titles.category},{title:Laravel.strings.user_requests_modal.table_columns_titles.properties},{data:null,defaultContent:""}],columnDefs:[{targets:[0,1,2,3],orderable:!1},{sClass:"center",aTargets:[1,3]},{targets:0,visible:!1},{targets:-1,render:function(e,t,a){return'<a href="javascript:void(0);" class="btn btn-warning btn-edit-request" data-request-id="'+e[0]+'"><i class="fa fa-pencil" aria-hidden="true"></i></a> <a href="javascript:void(0);" class="btn btn-danger btn-delete-request" data-request-id="'+e[0]+'"><i class="fa fa-trash" aria-hidden="true"></i></a>'}}],language:{url:"ar"===Laravel.locale?null:Laravel.assets.dataTables.lang.default,sProcessing:"جارٍ التحميل...",sLengthMenu:"أظهر _MENU_ مدخلات",sZeroRecords:"لا يوجد متابعات",sInfo:"إظهار _START_ إلى _END_ من أصل _TOTAL_ مدخل",sInfoEmpty:"لا يوجد متابعات",sInfoFiltered:"(منتقاة من مجموع _MAX_ مُدخل)",sInfoPostFix:"",sSearch:"ابحث:",sUrl:"",oPaginate:{sFirst:"الأول",sPrevious:"السابق",sNext:"التالي",sLast:"الأخير"}}}),$("#"+r).modal("show")},error:function(e){}})}),$(document).on("click","#btn-add-request",function(){function e(e){var t="";t+='class="btn btn-success btn-block" type="submit"';var a={attributes:t,text:Laravel.strings.create_request_modal.btn.submit,icon:"fa fa-plus"},s="";s+='data-category-id="{0}" '.format(e.id);var r={id:Constants.CREATE_REQUEST_FORM_ID,url:Laravel.apis.requests.store,method:"POST",classes:"",button_template_data:a,extra_attrs:s,skip_required:!0},n=[];n.push({code:"category_id",value_type:"HIDDEN",title:"",required:1,id:0,extra_settings:{default:e.id,hint:""}}),e&&e.properties&&$.each(e.properties,function(e,t){n.push(t)});var i=generateForm(n,r),o=Constants.CREATE_REQUEST_MODAL_ID,l=Constants.MODAL_TEMPLATE_ID,d='<p class="bg-info"><i class="fa fa-info" aria-hidden="true" style="margin-right: 6px;font-size: 16px;margin-left: 5px;"></i> '+Laravel.strings.create_request_modal.help_message+"</p> ",u={modal:{id:o,title:Laravel.strings.create_request_modal.modal_title,class:"auto-destroy",backdrop:"static",keyboard:"false",body:d+i,no_footer:!0,large:!1}},c="#"+Constants.MODALS_CONTAINER_ID;_.renderTemplate(l,u,c,!0),$(".modal").modal("hide"),$("#"+o).modal("show")}var t=[{text:Laravel.strings.post_category_type_modal.default_item_text,value:""}];$.each(Storages.localStorage.get("categories"),function(e,a){t.push({text:a.name,value:a.id})}),bootbox.prompt({title:Laravel.strings.post_category_type_modal.modal_title,inputType:"select",inputOptions:t,buttons:{confirm:{label:Laravel.strings.post_category_type_modal.modal_confirm_button_text,className:"btn-success"},cancel:{label:"Cancel",className:"btn-danger hidden"}},callback:function(t){if(null===t)return!1;if(""===t)return!1;var a=_.find(Storages.localStorage.get("categories"),{id:parseInt(t)});a&&e(a)}})}),$(document).on("click",".btn-edit-request",function(e){e.preventDefault();var t=$(this).data("request-id"),a=function(e){var a=e.category,s="";s+='class="btn btn-warning btn-block" type="submit"';var r={attributes:s,text:Laravel.strings.create_request_modal.btn.edit,icon:"fa fa-edit"},n="";n+='data-category-id="{0}" '.format(a.id),n+='data-request-id="{0}" '.format(t);var i={id:Constants.UPDATE_REQUEST_FORM_ID,url:Laravel.apis.requests.update.format(t),method:"PUT",classes:"",button_template_data:r,extra_attrs:n,skip_required:!0},o=[];o.push({code:"category_id",value_type:"HIDDEN",title:"",required:1,id:0,extra_settings:{default:a.id,hint:""}});var l=e.properties;a&&a.properties&&$.each(a.properties,function(e,t){var a=_.filter(l,function(e){return e.id===t.id})[0];a&&(t.input_value=a.input_value),o.push(t)});var d=generateForm(o,i),u=Constants.UPDATE_REQUEST_MODAL_ID,c=Constants.MODAL_TEMPLATE_ID,m='<p class="bg-info"><i class="fa fa-info" aria-hidden="true" style="margin-right: 6px;font-size: 16px;margin-left: 5px;"></i> '+Laravel.strings.create_request_modal.help_message+"</p> ",f={modal:{id:u,title:Laravel.strings.create_request_modal.modal_title,class:"auto-destroy",backdrop:"static",keyboard:"false",body:m+d,no_footer:!0,large:!1}},p="#"+Constants.MODALS_CONTAINER_ID;_.renderTemplate(c,f,p,!0),$(".modal").modal("hide"),$("#"+u).modal("show")};$.ajax({url:Laravel.apis.requests.get.format(t),method:"GET",success:a,error:function(e){}})}),$(document).on("submit","#{0}".format(Constants.CREATE_REQUEST_FORM_ID),function(e){e.preventDefault();var t=$(this).serializeArray().asMap("name","value");$.each(t,function(e,a){""===a&&(t[e]=null)}),$.ajax({url:Laravel.apis.requests.store,method:"POST",dataType:"json",data:JSON.stringify(t),success:function(e){var t=e.message;generateNotification(t,"success",!0,2500),$(".modal").modal("hide")},error:function(e){}})}),$(document).on("submit","#{0}".format(Constants.UPDATE_REQUEST_FORM_ID),function(e){e.preventDefault();var t=$(this).data("request-id"),a=$(this).serializeArray().asMap("name","value");$.each(a,function(e,t){""===t&&(a[e]=null)}),$.ajax({url:Laravel.apis.requests.update.format(t),method:"PUT",dataType:"json",data:JSON.stringify(a),success:function(e){var t=e.message;generateNotification(t,"success",!0,2500),$(".modal").modal("hide")},error:function(e){}})})});